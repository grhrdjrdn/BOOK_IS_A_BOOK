<h1>Hello <%= current_user.nickname %>, this is your Dashboard</h1>

<h1>Requests you made:</h1>

<% @my_requests.each do |item| %>
  <p>Request (<%= item.created_at.utc.getlocal.strftime("%F  %H:%M") %>)</p>
  <p><%= link_to item.book.title, item.book %> by <%= item.book.authors %> </p>
  <p>requested from owner <%= item.history.user.nickname %></p>
  <p><%= item.status %></p>
  <p>- - -</p>
<% end %>


<h1>Ingoing requests:</h1>

<div data-controller="request-status">
  <% @incoming_requests.each do |item| %>
    <div class='<%= item.status %>'>
      <p>Request (<%= item.created_at.utc.getlocal.strftime("%F  %H:%M") %>) from <%= item.user.nickname %></p>
      <p><%= link_to item.book.title, item.book %> by <%= item.book.authors %> </p>
      <p>owned by <%= item.book.current_owner.nickname %></p>
      <p class='status'><%= item.status %></p>
      <button class='btn-deny'data-action="request-status#send" data-request-status-action-param="deny" data-request-status-path-param="<%= request_deny_path(item) %>">Deny</button>
      <button class='btn-approve' data-action="request-status#send" data-request-status-action-param="approve" data-request-status-path-param="<%= request_approve_path(item) %>">Swap!</button></td>
      <p>- - -</p>
    </div>
  <% end %>
</div>

<h1>Books you currently own:</h1>

<% @my_books.each do |item| %>

  <%= cl_image_tag item.book.photo.key, crop: :fill %>
  <p><%= link_to item.book.title, item.book %> by <%= item.book.authors %> </p>
  <p>Acquired on <%= item.date_acquired.utc.getlocal.strftime("%F  %H:%M") %></p>

<% end %>

<h1>Books you previously owned:</h1>
<% @my_previously_owned_books.each do |item| %>
  <%= cl_image_tag item.book.photo.key, crop: :fill %>
  <p><%= link_to item.book.title, item.book %> by <%= item.book.authors %> </p>
  <p>Acquired on <%= item.date_acquired.utc.getlocal.strftime("%F  %H:%M") %> and
  swapped on <%= item.next_history.date_acquired.utc.getlocal.strftime("%F  %H:%M") %></p>
<% end %>
